# Operation Legal Shield: License Compliance Configuration
# Clearance: COSMIC
# Purpose: Enforce permissive license whitelist and block copyleft licenses
#
# This configuration is used by cargo-deny to audit all Rust dependencies
# for license compliance before desktop releases.

[graph]
# Ensure all workspace members are checked
targets = []
all-features = false
no-default-features = false

[advisories]
# Security audit configuration
db-path = "~/.cargo/advisory-db"
db-urls = ["https://github.com/rustsec/advisory-db"]
vulnerability = "deny"
unmaintained = "warn"
yanked = "warn"
notice = "warn"
ignore = []

[licenses]
# License compliance policy - PERMISSIVE ONLY
unlicensed = "deny"
# Do not allow packages with ambiguous or unknown licenses
allow-osi-fsf-free = "neither"
copyleft = "deny"
# Default action for licenses not in allow or deny lists
default = "deny"

# WHITELIST: Permissive licenses only (MIT, Apache-2.0, BSD-3-Clause)
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-3-Clause",
    "BSD-2-Clause",
    "ISC",
    "0BSD",
    "Zlib",
    "Unicode-DFS-2016",
]

# DENY: All copyleft and reciprocal licenses
deny = [
    "GPL-2.0",
    "GPL-3.0",
    "AGPL-3.0",
    "LGPL-2.1",
    "LGPL-3.0",
    "MPL-2.0",
    "EPL-1.0",
    "EPL-2.0",
    "CDDL-1.0",
    "EUPL-1.2",
]

# Confidence threshold for license detection
confidence-threshold = 0.8

# Exception handling - must be manually reviewed
exceptions = []

[[licenses.clarify]]
# Ring uses custom license but is effectively MIT/ISC/OpenSSL
name = "ring"
version = "*"
expression = "MIT AND ISC AND OpenSSL"
license-files = [
    { path = "LICENSE", hash = 0xbd0eed23 }
]

[[licenses.clarify]]
# webpki uses custom license structure
name = "webpki"
version = "*"
expression = "ISC"
license-files = [
    { path = "LICENSE", hash = 0x001c7e6c }
]

[bans]
# Multiple versions of the same crate
multiple-versions = "warn"
# Wildcard dependencies (security risk)
wildcards = "warn"
# Highlight likely typos in crate names
highlight = "all"
# Git dependencies from outside the workspace (supply chain risk)
allow-git = []

# Skip checking dev-dependencies for license compliance
skip = []

# Specific crates to deny (if known vulnerabilities)
deny = []

# Allow certain duplicate dependencies if necessary
skip-tree = []

[sources]
# Source code provenance policy
unknown-registry = "deny"
unknown-git = "deny"
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
allow-git = []

# Allow organization-internal repositories if needed
# allow-git = ["https://github.com/FourMIK/*"]
